{% extends "base/BaseAdmin.html" %} 
{% block Titulo %}Mapa Interactivo - Google Maps{% endblock Titulo %} 

{% block body %}
<style>
  html,
  body,
  #map {
    height: 100%;
    width: auto;
    display: flex;
    flex-direction: column;
    margin: 0;
    padding: 0 !important;
  }

  .container {
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 0 !important;
  }

  .map-controls {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 12px;
    z-index: 1000;
  }

  .map-controls button {
    background-color: #3498db;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    transition: all 0.3s;
  }

  .map-controls button:hover {
    background-color: #2980b9;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }

  #map {
    flex-grow: 1;
    width: auto;
    z-index: 1;
  }

  .custom-info-window {
    padding: 12px 15px 15px 15px;
    max-width: 320px;
    min-width: 250px;
    font-family: Arial, sans-serif;
    box-sizing: border-box;
  }

  .custom-info-window h3 {
    margin: 0 0 8px 0;
    color: #2c3e50;
    border-bottom: 2px solid #ED6D4A;
    padding-bottom: 6px;
    font-size: 1.1rem;
    line-height: 1.2;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .custom-info-window .horario {
    color: #6c757d;
    font-weight: bold;
    margin: 8px 0;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 5px;
    line-height: 1.3;
  }

  .custom-info-window .descripcion {
    margin: 10px 0 0 0;
    color: #555;
    font-size: 0.9rem;
    line-height: 1.4;
    text-align: left;
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    max-height: none;
    overflow: visible;
  }

  .info-divider {
    height: 1px;
    background-color: #f1a89b;
    margin: 8px 0;
  }

  .admin-buttons {
    display: flex;
    gap: 8px;
    margin-top: 12px;
  }

  .admin-buttons button {
    flex: 1;
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s;
  }

  .btn-editar {
    background-color: #f39c12;
    color: white;
  }

  .btn-editar:hover {
    background-color: #e67e22;
  }

  .btn-eliminar {
    background-color: #e74c3c;
    color: white;
  }

  .btn-eliminar:hover {
    background-color: #c0392b;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
  }

  .modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 500px;
    animation: modalSlideIn 0.3s ease-out;
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-50px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #ED6D4A;
  }

  .modal-header h2 {
    margin: 0;
    color: #2c3e50;
    font-size: 1.4rem;
  }

  .close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
  }

  .close:hover {
    color: #e74c3c;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #2c3e50;
    text-align: left;
  }

  .form-group input,
  .form-group textarea,
  .form-group select {
    width: 100%;
    padding: 10px 12px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s;
    box-sizing: border-box;
  }

  .form-group input:focus,
  .form-group textarea:focus,
  .form-group select:focus {
    outline: none;
    border-color: #ED6D4A;
  }

  .form-group textarea {
    resize: vertical;
    min-height: 100px;
    font-family: Arial, sans-serif;
  }

  .horario-selector {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
  }

  .horario-time-group {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .horario-time-group label {
    font-size: 0.8rem;
    margin-bottom: 5px;
    color: #555;
    font-weight: normal;
    text-align: left;
  }

  .horario-separator {
    margin-top: 20px;
    font-weight: bold;
    color: #666;
    padding: 0 5px;
  }

  .horario-current {
    margin-top: 5px;
    font-size: 0.75rem;
    color: #3498db;
    font-style: italic;
    text-align: left;
  }

  .horario-new {
    margin-top: 5px;
    font-size: 0.75rem;
    color: #27ae60;
    font-weight: bold;
    text-align: left;
  }

  .time-input {
    width: 100% !important;
  }

  .modal-buttons {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 25px;
  }

  .modal-buttons button {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.3s;
  }

  .btn-cancelar {
    background-color: #95a5a6;
    color: white;
  }

  .btn-cancelar:hover {
    background-color: #7f8c8d;
  }

  .btn-guardar {
    background-color: #ED6D4A;
    color: white;
  }

  .btn-guardar:hover {
    background-color: #e55a35;
  }

  .swal2-popup.custom-swal {
    padding: 25px;
    border-radius: 10px;
    max-width: 500px;
    width: 90% !important;
    overflow-x: hidden !important;
  }

  .swal2-container {
    overflow-x: hidden !important;
  }

  .custom-swal-title {
    color: #2c3e50;
    font-size: 1.4rem;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #ED6D4A;
    text-align: left;
  }

  .custom-swal-content {
    padding: 0;
    overflow-x: hidden !important;
  }

  .custom-form-group {
    margin-bottom: 20px;
  }

  .custom-form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #2c3e50;
    font-size: 0.95rem;
    text-align: left;
  }

  .custom-form-group input,
  .custom-form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s;
    box-sizing: border-box;
  }

  .custom-form-group input:focus,
  .custom-form-group textarea:focus {
    outline: none;
    border-color: #ED6D4A;
  }

  .custom-form-group textarea {
    resize: vertical;
    min-height: 100px;
    font-family: Arial, sans-serif;
  }

  .custom-horario-section {
    margin: 20px 0;
  }

  .custom-horario-section .section-title {
    font-size: 0.95rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 12px;
    display: block;
    text-align: left;
  }

  .custom-horario-selector {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
  }

  .custom-time-group {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .custom-time-group label {
    font-size: 0.8rem;
    margin-bottom: 5px;
    color: #555;
    font-weight: normal;
    text-align: left;
  }

  .custom-time-separator {
    margin-top: 20px;
    font-weight: bold;
    color: #666;
    padding: 0 5px;
  }

  .custom-time-input {
    width: 100% !important;
    padding: 10px !important;
  }

  .gm-style .gm-style-iw-c {
    padding: 0 !important;
    max-width: 350px !important;
  }

  .gm-style .gm-style-iw-t::after {
    background: none !important;
  }

  .swal2-html-container {
    overflow-x: hidden !important;
    max-width: 100% !important;
  }

  .custom-swal {
    padding: 20px !important;
    border-radius: 10px !important;
  }

  .custom-swal-title {
    color: #2c3e50 !important;
    font-size: 1.4rem !important;
    margin-bottom: 20px !important;
    padding-bottom: 15px !important;
    border-bottom: 2px solid #ED6D4A !important;
    text-align: left !important;
    width: 100% !important;
  }

  .custom-swal-content {
    padding: 0 !important;
    margin: 0 !important;
    overflow-x: hidden !important;
    width: 100% !important;
  }

  .swal2-confirm {
    background-color: #ED6D4A !important;
  }

  .swal2-confirm:hover {
    background-color: #e55a35 !important;
  }

  .swal2-cancel {
    background-color: #95a5a6 !important;
  }

  .custom-form-group {
    margin-bottom: 20px;
    width: 100%;
  }

  .custom-form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #2c3e50;
    font-size: 0.95rem;
    text-align: left;
    width: 100%;
  }

  .custom-horario-section {
    margin: 20px 0;
    width: 100%;
  }

  .custom-horario-section .section-title {
    font-size: 0.95rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 12px;
    display: block;
    text-align: left;
  }

  .custom-horario-selector {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }

  .custom-time-group {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .custom-time-group label {
    font-size: 0.8rem;
    margin-bottom: 5px;
    color: #555;
    font-weight: normal;
    text-align: left;
  }

  .custom-time-separator {
    margin-top: 20px;
    font-weight: bold;
    color: #666;
    padding: 0 5px;
  }
</style>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- SweetAlert2 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<div class="container">
  <div class="map-controls">
    <button id="resetView"><i class="fas fa-home"></i> Vista Inicial</button>
    {% if user_role == 'Administrador' %}
    <button id="addMarker">
      <i class="fas fa-map-marker-alt"></i> Agregar Marcador
    </button>
    {% endif %}
  </div>

  <div id="map"></div>
</div>

<!-- Modal para Editar Marcador -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Editar Marcador</h2>
      <span class="close">&times;</span>
    </div>
    <form id="editForm">
      <input type="hidden" id="editDocId">
      <input type="hidden" id="editUserId">
      <input type="hidden" id="editLatitud">
      <input type="hidden" id="editLongitud">
      
      <div class="form-group">
        <label for="editNombre">Nombre:</label>
        <input type="text" id="editNombre" required>
      </div>
      
      <div class="form-group">
        <label>Horario:</label>
        <div class="horario-selector">
          <div class="horario-time-group">
            <label>Hora de Apertura:</label>
            <input type="time" id="editHoraApertura" class="time-input" required>
            <div class="horario-current" id="currentApertura"></div>
          </div>
          <div class="horario-separator">-</div>
          <div class="horario-time-group">
            <label>Hora de Cierre:</label>
            <input type="time" id="editHoraCierre" class="time-input" required>
            <div class="horario-current" id="currentCierre"></div>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="editDescripcion">Descripción:</label>
        <textarea id="editDescripcion" required></textarea>
      </div>
      
      <div class="modal-buttons">
        <button type="button" class="btn-cancelar" id="cancelEdit">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button type="submit" class="btn-guardar">
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </div>
    </form>
  </div>
</div>

<script src="{{ url_for('static', filename='js/RenderMap.js') }}"></script>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

<script>
  const userRole = "{{ user_role }}";
  console.log("Rol del usuario en template:", userRole);
  
  // Función para inicializar el mapa una vez que la API esté lista
  function initializeMap() {
    const locations = {{ locations | safe }};
    initMap(locations, userRole);
  }
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places&callback=initializeMap">
</script>

<noscript>
  <div style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    ">
    <h2>Se requiere JavaScript para ver el mapa</h2>
    <p>
      Por favor, active JavaScript en su navegador para utilizar esta
      funcionalidad.
    </p>
  </div>
</noscript>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mainContent = document.querySelector('.main-content');
    if (mainContent) {
      mainContent.style.display = 'flex';
      mainContent.style.flexDirection = 'column';
      mainContent.style.padding = '0';
    }
  });
</script>

{% endblock body %}