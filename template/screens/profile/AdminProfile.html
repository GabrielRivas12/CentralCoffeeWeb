{% extends "base/BaseAdmin.html" %}

{% block Titulo %}Perfil - Administrador{% endblock Titulo %}

{% block body %}
<div class="container-fluid px-0 profile-container">
  <div id="ProfileInfo" class="container-fluid px-0">
    <!-- Secci贸n de Im谩genes -->
    <div id="Images" class="position-relative">
      <!-- Foto de portada con ancho reducido -->
      <div class="d-flex justify-content-center">
        <div class="profile-cover-wrapper">
          {%if user.fotoPortada %}
          <img src="{{ user.fotoPortada }}" id="ProfileCover" class="img-fluid profile-cover-img rounded-4"
            alt="Portada de perfil" style="height: 300px; object-fit: cover;" />
          {% else %}
          <img src="{{ url_for('static', filename='img/debugimages/ProfileCover.jpg') }}" id="ProfileCover"
            class="img-fluid profile-cover-img rounded-4" alt="Portada de perfil"
            style="height: 300px; object-fit: cover;" />
          {% endif %}
        </div>
      </div>

      <div class="container">
        <div class="row align-items-end">
          <div class="col-auto position-relative profile-pic-container" style="top: -60px;">
            {% if user.fotoPerfil %}
            <img src="{{ user.fotoPerfil }}" class="rounded-circle profile-img border border-4 border-white shadow-sm"
              alt="Imagen de perfil" style="width: 120px; height: 120px; object-fit: cover;" />
            {% else %}
            <img src="{{ url_for('static', filename='img/debugimages/ImageProfile.jpg') }}"
              class="rounded-circle profile-img border border-4 border-white shadow-sm" alt="Imagen de perfil"
              style="width: 120px; height: 120px; object-fit: cover;" />
            {% endif %}
          </div>
        </div>
      </div>

      <!-- informaci贸n del usuario -->
      <div class="container">
        <div class="row">
          <div class="col position-relative profile-info-container">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h1 class="h3 fw-bold text-dark">{{ user.nombre }}</h1>
                <p class="text-muted ">
                  {% if user.role == 'comerciante' %}
                  Comerciante
                  {% else %}
                  {{ user.role|title }}
                  {% endif %}
                </p>
              </div>
              <!-- Bot贸n Editar Perfil -->
              <div class="edit-profile-btn-container" style="margin-right: 100px;">
                <button type="button" class="btn btn-custom-edit" data-bs-toggle="modal"
                  data-bs-target="#editProfileModal">
                  <i class="fas fa-edit me-2"></i>Editar Perfil
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="ProfileContent" class="container mt-0 pt-0">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-10 col-xl-10">

          <!-- Secci贸n Sobre m铆 -->
          <hr class="my-4" />
          <div class="mb-4">
            <h4 class="h5 fw-semibold mb-3">Sobre m铆</h4>
            {% if user.descripcion %}
            <p class="text-muted mb-0">
              {{ user.descripcion }}
            </p>
            {% else %}
            <p class="text-muted mb-0">
              Este usuario no tiene una descripci贸n
            </p>
            {% endif %}
          </div>

          <!-- Ubicaci贸n -->
          <div class="row mb-4">
            <div class="col-12">
              <h4 class="h5 fw-semibold mb-3"> Ubicaci贸n</h4>
              <p class="mb-0 text-body">
                {% if user.ubicacion %}
                {{ user.ubicacion }}
                {% else %}
                No especificado
                {% endif %}
              </p>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Edici贸n de Perfil -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header" style="background-color: #f1a89b;">
        <h5 class="modal-title text-white" id="editProfileModalLabel">
          <i class="fas fa-user-edit me-2"></i>Editar Perfil
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editProfileForm" action="{{ url_for('profile.update_profile') }}" method="POST"
          enctype="multipart/form-data">
          <div class="row">
            <div class="col-12 col-md-6 mb-3">
              <label for="profilePhoto" class="form-label fw-semibold">
                <i class="fas fa-camera me-1"></i>Foto de Perfil
              </label>
              <input class="form-control" type="file" id="profilePhoto" name="profilePhoto" accept="image/*">
            </div>
            <div class="col-12 col-md-6 mb-3">
              <label for="coverPhoto" class="form-label fw-semibold">
                <i class="fas fa-image me-1"></i>Foto de Portada
              </label>
              <input class="form-control" type="file" id="coverPhoto" name="coverPhoto" accept="image/*">
            </div>
          </div>

          <div class="row">
            <div class="col-12 mb-3">
              <label for="location" class="form-label fw-semibold"> Ubicaci贸n</label>
              <input type="text" class="form-control" id="location" name="ubicacion" value="{{ user.ubicacion }}"
                placeholder="Ingresa tu ubicaci贸n">
            </div>
          </div>

          <div class="mb-3">
            <label for="description" class="form-label fw-semibold"> Sobre m铆</label>
            <textarea class="form-control" id="description" name="descripcion" rows="4"
              placeholder="Describe tu perfil...">{{ user.descripcion }}</textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>Cancelar
        </button>
        <button type="submit" form="editProfileForm" class="btn text-white" style="background-color: #ED6D4A; border-color: #ED6D4A;">
          <i class="fas fa-save me-1 text-white"></i>Guardar Cambios
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .rounded-top-4 {
    border-top-left-radius: 1rem !important;
    border-top-right-radius: 1rem !important;
  }

  .profile-img {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  }

  .profile-cover-wrapper {
    width: 85%;
    margin: 0 auto;
  }

  .profile-cover-img {
    width: 100% !important;
    height: 300px;
    object-fit: cover;
  }

  .profile-pic-container {
    margin-left: 100px !important;
    position: absolute;
    z-index: 10;
  }

  .profile-info-container {
    margin-top: -40px;
    margin-left: 100px;
    padding-bottom: 20px;
  }

  .edit-profile-btn-container {
    margin-left: -300px;
  }

  .btn-custom-edit {
    background-color: #ED6D4A !important;
    border-color: #ED6D4A !important;
    color: white !important;
    transition: all 0.2s ease;
  }

  .btn-custom-edit:hover {
    background-color: #e05a35 !important;
    border-color: #e05a35 !important;
    color: white !important;
    transform: translateY(-1px);
  }

  .btn-custom-edit i {
    color: white !important;
  }

  .btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
    transition: all 0.2s ease;
  }

  .btn-primary:hover {
    background-color: #0b5ed7;
    border-color: #0a58ca;
    transform: translateY(-1px);
  }

  @media (max-width: 768px) {
    .profile-cover-wrapper {
      width: 95%;
    }

    .profile-cover-img {
      height: 200px !important;
    }

    .profile-img {
      width: 100px !important;
      height: 100px !important;
    }

    .profile-pic-container {
      margin-left: 0 !important;
      position: relative;
      text-align: center;
      display: flex;
      justify-content: center;
      width: 100%;
      top: -40px !important;
    }

    .profile-info-container {
      margin-left: 0 !important;
      margin-top: 0;
      text-align: center;
      padding-bottom: 10px;
    }

    .edit-profile-btn-container {
      margin-left: 0 !important;
      margin-top: 10px;
    }

    .row.align-items-end {
      text-align: center;
      flex-direction: column;
    }

    .d-flex.justify-content-between {
      flex-direction: column;
      align-items: center !important;
      text-align: center;
    }

    .btn-custom-edit {
      width: 100%;
      max-width: 200px;
    }
  }

  @media (max-width: 576px) {
    .profile-cover-wrapper {
      width: 100%;
    }

    .profile-cover-img {
      height: 150px !important;
      border-radius: 0.5rem !important;
    }

    .profile-img {
      width: 80px !important;
      height: 80px !important;
    }

    .profile-pic-container {
      top: -30px !important;
    }
  }
</style>
{% endblock body %}